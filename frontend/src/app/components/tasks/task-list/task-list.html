<div class="list-container" [class.edit-mode]="isEditMode">
    <!-- List Header -->
    <div class="list-header" [class.editable]="isEditMode">
        @if (isEditingTitle()) {
        <input #titleInput [(ngModel)]="editedTitle" (keydown.enter)="confirmEditTitle()"
            (keydown.escape)="cancelEditingTitle()" (blur)="confirmEditTitle()" class="title-input" />
        } @else {
        <span (click)="startEditingTitle()" [class.clickable]="isEditMode">{{ taskList.name }}</span>
        @if (isEditMode) {
        <div class="edit-actions">
            <button class="delete-list-btn" (click)="confirmDelete($event)" title="Delete list">
                <mat-icon>delete</mat-icon>
            </button>
            <mat-icon class="drag-handle" cdkDragHandle>drag_indicator</mat-icon>
        </div>
        }
        }
    </div>

    <!-- Tasks Container -->
    <div class="tasks-container" cdkDropList [cdkDropListData]="taskList.tasks || []" [id]="'' + taskList.id"
        [cdkDropListConnectedTo]="connectedLists" (cdkDropListDropped)="drop($event)">

        @for(task of filteredTasks; track task.id) {
        <app-task-card [task]="task" [cdkDragData]="task" cdkDrag [cdkDragStartDelay]="dragDelay"
            (cdkDragStarted)="cardDragStarted.emit()" (cdkDragEnded)="cardDragEnded.emit()"></app-task-card>
        }

        @if (isAddingTask()) {
        <div class="new-task-form">
            <textarea #taskInput [(ngModel)]="newTaskName" (keydown.enter)="confirmAddTask(); $event.preventDefault()"
                (keydown.escape)="cancelAddingTask()" class="new-task-card-input"
                placeholder="Enter a title for this card..." rows="3"></textarea>
            <div class="new-task-actions">
                <button (click)="confirmAddTask()" class="add-card-btn">Add card</button>
                <button (click)="cancelAddingTask()" class="cancel-btn">
                    <mat-icon class="icon-lg">close</mat-icon>
                </button>
            </div>
        </div>
        }
    </div>

    <!-- New Task Button -->
    @if (!isAddingTask()) {
    <div class="new-task-wrapper">
        <button class="new-task-btn" (click)="startAddingTask()">
            <mat-icon class="icon-lg">add</mat-icon>
            <span>New task</span>
        </button>
    </div>
    }
</div>