<h2 mat-dialog-title>
  @if (data.orderItem) {
    Edit Line Item
  } @else {
    Add Line Item
  }
</h2>

<mat-dialog-content>
  <form [formGroup]="form" class="dialog-form">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Line Type</mat-label>
      <mat-select formControlName="orderLineTypeID" required>
        @for (type of orderLineTypes(); track type.id) {
          <mat-option [value]="type.id">{{ type.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    @if (isPartLineType()) {
      <!-- Part Autocomplete -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Select Part</mat-label>
        <input
          type="text"
          matInput
          formControlName="partSearch"
          [matAutocomplete]="auto"
          placeholder="Search by SKU, name, or description">
        <mat-icon matPrefix>search</mat-icon>
        <mat-autocomplete #auto="matAutocomplete" [displayWith]="formatPartDisplay.bind(this)" (optionSelected)="onPartSelected($event.option.value)">
          @for (part of filteredParts | async; track part.id) {
            <mat-option [value]="part">
              <div class="part-option">
                <div class="part-option-main">
                  <strong>{{ part.sku || 'No SKU' }}</strong> - {{ part.name }}
                </div>
                <div class="part-option-subtitle">
                  {{ part.description }} | Vendor: {{ part.vendor }}
                </div>
              </div>
            </mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
    } @else {
      <!-- Description for non-Part line items -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <input matInput formControlName="name" placeholder="Enter description">
      </mat-form-field>
    }

    <div class="form-row">
      <mat-form-field appearance="outline">
        <mat-label>Quantity</mat-label>
        <input matInput type="number" formControlName="quantity" min="1" required>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Unit Price</mat-label>
        <input matInput type="number" formControlName="price" min="0" step="0.01" required>
        <span matTextPrefix>$&nbsp;</span>
      </mat-form-field>
    </div>

    <div class="total-preview">
      Line Total: <strong>${{ lineTotal().toFixed(2) }}</strong>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">Cancel</button>
  <button mat-flat-button color="primary" (click)="save()">
    @if (data.orderItem) {
      Save
    } @else {
      Add
    }
  </button>
</mat-dialog-actions>
