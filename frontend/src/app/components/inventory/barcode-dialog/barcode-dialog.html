<mat-dialog-content>
    <div class="barcode-container">
        @if (isLoading() && !error()) {
        <div class="loading">
            <mat-spinner diameter="50"></mat-spinner>
            <p>Loading barcode...</p>
        </div>
        }
        @if (error()) {
        <div class="error">
            <p>{{ error() }}</p>
        </div>
        }
        @if (barcodeImageUrl()) {
        <div class="barcode-display" [class.hidden]="isLoading()">
            <img [src]="barcodeImageUrl()" alt="Barcode" class="barcode-img" (load)="onImageLoad()"
                (error)="onImageError()" />
        </div>
        }

        <!-- Preview Options (Always Visible) -->
        <div class="preview-options">
            <h3>Preview Options</h3>

            <mat-form-field appearance="outline">
                <mat-label>Preview Size</mat-label>
                <mat-select [(ngModel)]="selectedPreviewSize" (ngModelChange)="onPreviewSizeChange()">
                    @for (size of labelSizes; track size.value) {
                        <mat-option [value]="size.value">{{ size.label }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </div>

        <!-- Print Options (Show when button clicked) -->
        @if (showPrintOptions()) {
        <div class="print-options">
            <h3>Print Options</h3>

            <mat-form-field appearance="outline">
                <mat-label>Print Label Size</mat-label>
                <mat-select [(ngModel)]="selectedLabelSize">
                    @for (size of labelSizes; track size.value) {
                        <mat-option [value]="size.value">{{ size.label }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Printer</mat-label>
                <mat-select [(ngModel)]="selectedPrinterIP">
                    @for (printer of printers; track printer.ip) {
                        <mat-option [value]="printer.ip">{{ printer.name }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </div>
        }
    </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
    <button mat-button (click)="moveBarcode()" style="margin-right: auto;">Move</button>
    @if (!showPrintOptions()) {
        <button mat-raised-button color="primary" (click)="togglePrintOptions()" [disabled]="!barcodeId()">
            Print Label
        </button>
    } @else {
        <button mat-button (click)="togglePrintOptions()">Cancel</button>
        <button mat-raised-button color="primary" (click)="printLabel()" [disabled]="isPrinting() || !barcodeId()">
            @if (isPrinting()) {
                Printing...
            } @else {
                Confirm Print
            }
        </button>
    }
    <button mat-button mat-dialog-close>Close</button>
</mat-dialog-actions>