<div class="harness-page">
  <app-harness-toolbar
    [hasChanges]="hasUnsavedChanges()"
    [isSaving]="isSaving()"
    [zoomLevel]="zoomLevel()"
    [gridEnabled]="gridEnabled()"
    [harnessName]="harnessData()?.name || ''"
    [harnessPartNumber]="harnessData()?.partNumber || ''"
    [harnessRevision]="harnessData()?.revision || ''"
    [hasElementSelected]="currentSelection()?.type === 'connector' || currentSelection()?.type === 'cable' || currentSelection()?.type === 'component' || currentSelection()?.type === 'subHarness'"
    [activeTool]="activeTool()"
    [canUndo]="canUndo()"
    [canRedo]="canRedo()"
    [isLocked]="isLocked()"
    (newHarness)="onNewHarness()"
    (openHarness)="onOpenHarness()"
    (save)="onSave()"
    (exportJSON)="onExportJSON()"
    (exportPNG)="onExportPNG()"
    (importJSON)="onImportJSON()"
    (addConnector)="onAddConnector()"
    (addCable)="onAddCable()"
    (addComponent)="onAddComponent()"
    (addSubHarness)="onAddSubHarness()"
    (deleteSelected)="onDeleteSelected()"
    (rotateConnector)="rotateSelected(90)"
    (flipConnector)="flipSelected()"
    (zoomIn)="onZoomIn()"
    (zoomOut)="onZoomOut()"
    (resetZoom)="onResetZoom()"
    [showSubHarnessBounds]="showSubHarnessBounds()"
    (gridEnabledChange)="gridEnabled.set($event)"
    (showSubHarnessBoundsChange)="showSubHarnessBounds.set($event)"
    (toolChanged)="onToolChanged($event)"
    (undo)="onUndo()"
    (redo)="onRedo()">
  </app-harness-toolbar>

  <div class="main-content">
    @if (isViewOnly()) {
    <div class="view-only-badge">
      <mat-icon>visibility</mat-icon>
      View Only
    </div>
    }
    <app-harness-canvas
      #harnessCanvas
      [harnessData]="harnessData()"
      [activeTool]="activeTool()"
      [gridEnabled]="gridEnabled()"
      [gridSize]="20"
      [isLocked]="isLocked()"
      [showSubHarnessBounds]="showSubHarnessBounds()"
      (selectionChanged)="onSelectionChanged($event)"
      (dataChanged)="onDataChanged($event)"
      (connectorMoved)="onConnectorMoved($event)"
      (cableMoved)="onCableMoved($event)"
      (componentMoved)="onComponentMoved($event)"
      (editConnector)="onEditConnector($event)"
      (editCable)="onEditCable($event)"
      (editComponent)="onEditComponent($event)"
      (editChildConnector)="onEditChildConnector($event)"
      (editChildCable)="onEditChildCable($event)"
      (editChildComponent)="onEditChildComponent($event)"
      (bringToFront)="onBringToFront()"
      (moveForward)="onMoveForward()"
      (moveBackward)="onMoveBackward()"
      (sendToBack)="onSendToBack()"
      (rotateSelected)="rotateSelected(90)"
      (flipSelected)="flipSelected()"
      (requestDelete)="onDeleteSelected()"
      (requestToolChange)="onCanvasToolChangeRequest($event)"
      (subHarnessDataChanged)="onSubHarnessDataChanged($event)"
      (subHarnessEditModeChanged)="onSubHarnessEditModeChanged($event)"
      (dragStart)="onDragStart()"
      (dragEnd)="onDragEnd()">
    </app-harness-canvas>

    <app-harness-property-panel
      [harnessData]="harnessData()"
      [selection]="currentSelection()"
      [isReleased]="isReleased()"
      [isInReview]="isInReview()"
      [isLocked]="isLocked()"
      [isViewOnly]="isViewOnly()"
      (metadataChanged)="onMetadataChanged($event)"
      (connectorChanged)="onConnectorPropertyChanged($event)"
      (connectionChanged)="onConnectionPropertyChanged($event)"
      (bulkWiresChanged)="onBulkWiresChanged($event)"
      (pinLabelChanged)="onPinLabelChanged($event)"
      (deleteConnector)="onDeleteSelected()"
      (deleteCable)="onDeleteSelected()"
      (deleteComponent)="onDeleteSelected()"
      (deleteConnection)="onDeleteSelected()"
      (deleteHarness)="onDeleteHarness()"
      (releaseHarness)="onReleaseHarness()"
      (returnToDraft)="onReturnToDraft()"
      (newRevision)="onNewRevision()">
    </app-harness-property-panel>
  </div>
</div>
