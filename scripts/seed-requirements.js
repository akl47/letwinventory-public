#!/usr/bin/env node
/**
 * Seeds design requirements from docs/requirements.md into the running dev environment.
 * Usage: node scripts/seed-requirements.js
 */
const BASE = 'http://localhost:3000/api';

async function main() {
  // 1. Get auth token
  const loginRes = await fetch(`${BASE}/auth/google/test-login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: 'test@test.com' })
  });
  const { accessToken } = await loginRes.json();
  const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${accessToken}` };

  // 2. Get first project
  const projects = await (await fetch(`${BASE}/planning/project`, { headers })).json();
  const projectID = projects.find(p => p.name === 'Letwinventory')?.id || projects[0].id;
  console.log(`Using project: ${projectID}`);

  // 3. Create categories
  const categoryNames = [
    { name: 'System', description: 'General system-level requirements' },
    { name: 'QMS', description: 'Quality Management System (ISO 13485 / 21 CFR 820)' },
    { name: 'Design Controls', description: 'Design and development controls (21 CFR 820.30 / ISO 13485 §7.3)' },
    { name: 'Purchasing Controls', description: 'Purchasing and receiving controls (21 CFR 820.50)' },
    { name: 'Identification & Traceability', description: 'Product identification and traceability (21 CFR 820.60)' },
    { name: 'Production & Process Controls', description: 'Production and process controls (21 CFR 820.70)' },
    { name: 'Labeling Controls', description: 'Labeling controls (21 CFR 820.120)' },
    { name: 'Records & Data Integrity', description: 'Records and data integrity (21 CFR 820.180)' },
    { name: 'Operational Risk Management', description: 'Operational risk management (AS9100D §8.1.1)' },
    { name: 'Configuration Management', description: 'Configuration management (AS9100D §8.1.2)' },
    { name: 'Product Safety', description: 'Product safety (AS9100D §8.1.3)' },
    { name: 'Counterfeit Parts Prevention', description: 'Prevention of counterfeit parts (AS9100D §8.1.4)' },
    { name: 'External Providers', description: 'Control of externally provided products (AS9100D §8.4)' },
    { name: 'Production Process Verification', description: 'Production process verification / FAI (AS9100D §8.5.1.3)' },
    { name: 'Nonconforming Product', description: 'Nonconforming product control (AS9100D §8.7)' },
    { name: 'Authentication', description: 'Authentication and authorization' },
    { name: 'Inventory', description: 'Inventory management' },
    { name: 'Barcode', description: 'Barcode management' },
    { name: 'Parts', description: 'Parts management' },
    { name: 'Orders', description: 'Order management' },
    { name: 'Wire Harness', description: 'Wire harness design' },
    { name: 'Planning', description: 'Planning and task management' },
    { name: 'File Management', description: 'File upload and storage' },
    { name: 'Mobile', description: 'Mobile scanner' },
    { name: 'Configuration', description: 'Configuration and printer management' },
    { name: 'UX', description: 'UI/UX requirements' },
    { name: 'Notifications', description: 'Push notifications' },
    { name: 'Design Requirements', description: 'Design requirements management feature' },
    { name: 'Development', description: 'Development and deployment requirements' },
  ];

  const catMap = {};
  for (const cat of categoryNames) {
    const res = await fetch(`${BASE}/design/requirement-category`, {
      method: 'POST', headers,
      body: JSON.stringify(cat)
    });
    const data = await res.json();
    if (data.id) {
      catMap[cat.name] = data.id;
      console.log(`  Category: ${cat.name} → ${data.id}`);
    } else {
      console.log(`  Category ${cat.name} failed: ${JSON.stringify(data)}`);
    }
  }

  // 4. Create requirements - mapping reqId → { fields, categoryName, parentReqId }
  // We'll create them in order and track ID mappings for parent references
  const reqIdMap = {}; // REQ-XXX-NNN → database ID

  const requirements = [
    // Section 1.1 - System
    { reqId: 'REQ-SYS-001', cat: 'System', parent: null,
      description: 'The system shall provide a web-based enterprise resource application.',
      rationale: 'Centralized management of manufacturing workflow from procurement through assembly.',
      parameter: 'Web application accessible via modern browsers (Chrome, Firefox, Edge, Safari).',
      verification: 'All derived requirement verification criteria pass.',
      validation: 'User can log in and access all major functional areas.' },
    { reqId: 'REQ-SYS-004', cat: 'System', parent: 'REQ-SYS-001',
      description: 'The system shall use soft deletion for all user-created data by setting activeFlag = false rather than removing records.',
      rationale: 'Preserves audit trail and enables data recovery per 21 CFR 820.184 and ISO 13485:2016 §4.2.5.',
      parameter: 'All models with activeFlag field (BOOLEAN, default: true). Queries filter by activeFlag: true unless explicitly including inactive.',
      verification: 'DELETE endpoints set activeFlag=false. Record remains in database after deletion.',
      validation: 'Deleted items disappear from default views but can be recovered or shown via "Show Inactive" toggles.' },

    // Section 1.2 - QMS
    { reqId: 'REQ-SYS-QMS-001', cat: 'QMS', parent: null,
      description: 'The system shall enforce a Quality Management System (QMS) by providing documented procedures for all quality-affecting processes.',
      rationale: '21 CFR 820.20 requires each manufacturer to establish a quality system. ISO 13485:2016 §4.1 requires the organization to establish, document, implement, and maintain a QMS.',
      parameter: 'QMS scope covers: design controls, purchasing controls, identification and traceability, production and process controls, and records management.',
      verification: 'QMS documentation exists for each covered process. System enforces documented procedures via workflow constraints.',
      validation: 'Quality audit confirms all QMS processes are followed through the system.' },
    { reqId: 'REQ-SYS-QMS-002', cat: 'QMS', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall control all quality-related documents through version-controlled, reviewable, and approvable workflows.',
      rationale: '21 CFR 820.40 requires procedures for document controls. ISO 13485:2016 §4.2.4 requires control of documents.',
      parameter: 'Harness designs use release workflow (Draft → Review → Released). Released documents are immutable; changes create new revisions with full change history.',
      verification: 'Released documents cannot be modified. All changes create new revisions.',
      validation: 'Auditor can trace any document to its complete revision history.' },
    { reqId: 'REQ-SYS-QMS-003', cat: 'QMS', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall maintain quality records that are legible, readily identifiable, retrievable, and protected from damage, deterioration, or loss.',
      rationale: '21 CFR 820.180 requires general record-keeping. ISO 13485:2016 §4.2.5 requires control of records.',
      parameter: 'All records stored in PostgreSQL with automatic timestamps. Soft deletion prevents accidental loss. Records include: barcode history, task history, harness revision history, order history.',
      verification: 'All history tables include userID, timestamp, and action type. No records can be permanently deleted through the application.',
      validation: 'For any inventory item, auditor can retrieve complete history from creation through current state.' },
    { reqId: 'REQ-SYS-QMS-004', cat: 'QMS', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall enforce user authentication and record the identity of all personnel performing quality-affecting actions.',
      rationale: '21 CFR 820.20(b)(1) requires defined responsibility, authority, and interrelation of personnel.',
      parameter: 'Google OAuth authentication provides unique user identity. All create, update, and delete operations record userID.',
      verification: 'Every history record includes a non-null userID. All API endpoints require authentication.',
      validation: 'For any action in the system, auditor can identify which user performed it and when.' },

    // Section 1.3 - Design Controls
    { reqId: 'REQ-SYS-DC-001', cat: 'Design Controls', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall support design and development planning, including stages, review, verification, and validation activities for wire harness designs.',
      rationale: '21 CFR 820.30(b) requires design and development planning. ISO 13485:2016 §7.3.2 requires defined stages.',
      parameter: 'Harness designs progress through: Draft (active design), Review (design review), Released (design transfer).',
      verification: 'Harness cannot transition from Draft to Released without passing through Review.',
      validation: 'Engineering team follows defined design stages from initial draft through release.' },
    { reqId: 'REQ-SYS-DC-002', cat: 'Design Controls', parent: 'REQ-SYS-DC-001',
      description: 'The system shall capture and maintain design inputs including component specifications, pin configurations, and wire parameters.',
      rationale: '21 CFR 820.30(c) requires documented design inputs. ISO 13485:2016 §7.3.3 requires design and development inputs.',
      parameter: 'Design inputs stored in harnessData JSONB: connectors, cables, components, connections, subHarnesses.',
      verification: 'Harness data includes all required design input fields. Parts references are valid.',
      validation: 'Design inputs are complete and sufficient to manufacture the harness.' },
    { reqId: 'REQ-SYS-DC-003', cat: 'Design Controls', parent: 'REQ-SYS-DC-001',
      description: 'The system shall produce design outputs that can be verified against design inputs and that contain acceptance criteria.',
      rationale: '21 CFR 820.30(d) requires design outputs in terms that allow adequate evaluation against design inputs.',
      parameter: 'Design outputs: complete harness schematic with all connections, wire routing, and component placement. Exportable as JSON. Validation endpoint verifies structural integrity.',
      verification: 'Exported design contains all information needed for manufacturing. Validation catches structural errors.',
      validation: 'Manufacturing can build a harness from the released design output without additional information.' },
    { reqId: 'REQ-SYS-DC-004', cat: 'Design Controls', parent: 'REQ-SYS-DC-001',
      description: 'The system shall support design review at defined stages before transitioning to the next phase.',
      rationale: '21 CFR 820.30(e) requires formal documented reviews of design results at appropriate stages.',
      parameter: 'Review gate: Draft → Review transition. Rejection returns to Draft with notes. Approval proceeds to Released. Sub-harnesses cascade to review state.',
      verification: 'Design cannot be released without explicit review approval. Rejection notes are recorded.',
      validation: 'Design review meeting decisions are captured in the system as approve/reject with rationale.' },
    { reqId: 'REQ-SYS-DC-005', cat: 'Design Controls', parent: 'REQ-SYS-DC-001',
      description: 'The system shall maintain a complete design change history with the ability to revert to any previous design state.',
      rationale: '21 CFR 820.30(i) requires design changes to be identified, documented, validated, verified, reviewed, and approved.',
      parameter: 'HarnessRevisionHistory records all changes. Revision letters increment (A→B→...→Z→AA). Revert endpoint restores from any snapshot.',
      verification: 'Every design change creates a history entry with before-state snapshot.',
      validation: 'Auditor can view complete design evolution and revert to any prior version.' },

    // Section 1.4 - Purchasing Controls
    { reqId: 'REQ-SYS-PC-001', cat: 'Purchasing Controls', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall establish and maintain purchasing procedures to ensure purchased products conform to specified requirements.',
      rationale: '21 CFR 820.50 requires procedures for purchasing. ISO 13485:2016 §7.4.1 requires a purchasing process.',
      parameter: 'Orders include: vendor identification, part specifications, quantities, pricing. Order status workflow tracks procurement lifecycle.',
      verification: 'Orders require valid part references. Order status progression is enforced.',
      validation: 'Purchasing team can create, track, and receive orders with full traceability.' },
    { reqId: 'REQ-SYS-PC-002', cat: 'Purchasing Controls', parent: 'REQ-SYS-PC-001',
      description: 'The system shall maintain purchasing data that clearly describes the product or service ordered.',
      rationale: '21 CFR 820.50(b) requires purchasing documents to include a description of the purchased product.',
      parameter: 'OrderItem includes: partID (links to full part specification), quantity, price. Part record includes: name, vendor, SKU, manufacturer, manufacturerPN.',
      verification: 'Order items reference valid parts with complete specifications.',
      validation: 'Purchase order contains sufficient detail for supplier to provide correct product.' },
    { reqId: 'REQ-SYS-PC-003', cat: 'Purchasing Controls', parent: 'REQ-SYS-PC-001',
      description: 'The system shall support receiving inspection by tracking received quantities against ordered quantities.',
      rationale: '21 CFR 820.80 requires acceptance activities including receiving acceptance.',
      parameter: 'OrderItem tracks receivedQuantity vs quantity. Receiving creates Trace or Equipment records with RECEIVED barcode history action.',
      verification: 'Received quantities recorded against each line item.',
      validation: 'Receiving personnel can verify and record incoming products against the purchase order.' },

    // Section 1.5 - Identification & Traceability
    { reqId: 'REQ-SYS-IT-001', cat: 'Identification & Traceability', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall provide unique identification for all inventory items throughout their lifecycle using auto-generated barcodes.',
      rationale: '21 CFR 820.60 requires procedures for identifying product during all stages. ISO 13485:2016 §7.5.3 requires identification and traceability.',
      parameter: 'Every Location, Box, Trace, and Equipment receives a unique barcode (PREFIX-XXXXXX hex format).',
      verification: 'All inventory entities have unique, non-null barcodeID.',
      validation: 'Any physical item can be identified by scanning its barcode label.' },
    { reqId: 'REQ-SYS-IT-002', cat: 'Identification & Traceability', parent: 'REQ-SYS-IT-001',
      description: 'The system shall maintain a complete audit trail of all inventory movements, transformations, and status changes.',
      rationale: '21 CFR 820.184 requires a Device History Record (DHR). ISO 13485:2016 §7.5.9 requires traceability records.',
      parameter: 'BarcodeHistory records: CREATED, MOVED, RECEIVED, SPLIT, MERGED, DELETED actions with userID, timestamp.',
      verification: 'Every inventory action creates a history record. History records cannot be modified or deleted.',
      validation: 'For any inventory item, auditor can trace its complete history.' },
    { reqId: 'REQ-SYS-IT-003', cat: 'Identification & Traceability', parent: 'REQ-SYS-IT-001',
      description: 'The system shall support serial number and lot number tracking for parts that require it.',
      rationale: '21 CFR 820.65 requires traceability by control number (lot/serial).',
      parameter: 'Part model includes serialNumberRequired and lotNumberRequired flags. Trace records include optional serialNumber and lotNumber fields.',
      verification: 'Parts marked serialNumberRequired enforce serial number on trace creation.',
      validation: 'Auditor can trace a specific serial number or lot number through the complete supply chain.' },

    // Section 1.6 - Production & Process Controls
    { reqId: 'REQ-SYS-PP-001', cat: 'Production & Process Controls', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall support production planning through task management with defined workflows, scheduling, and time tracking.',
      rationale: '21 CFR 820.70 requires that production processes are controlled and monitored.',
      parameter: 'Task management with Kanban workflow. Task types include: normal, tracking, critical_path, scheduled.',
      verification: 'Tasks progress through defined workflow stages.',
      validation: 'Production activities are planned, tracked, and completed through the task system.' },
    { reqId: 'REQ-SYS-PP-002', cat: 'Production & Process Controls', parent: 'REQ-SYS-PP-001',
      description: 'The system shall provide controlled manufacturing specifications through released harness designs that are read-only and revision-controlled.',
      rationale: '21 CFR 820.70(a) requires production processes performed according to approved instructions.',
      parameter: 'Released harness designs are immutable. Edits to released designs create new revisions.',
      verification: 'Released harness cannot be modified through any API endpoint.',
      validation: 'Manufacturing uses only released designs; any required change follows the revision control process.' },

    // Section 1.7 - Labeling Controls
    { reqId: 'REQ-SYS-LC-001', cat: 'Labeling Controls', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall generate and print standardized barcode labels with consistent formatting for all inventory items.',
      rationale: '21 CFR 820.120 requires labeling activities to be controlled.',
      parameter: 'ZPL label generation with company branding, item name, description, and quantity. Two sizes: 3"x1" and 1.5"x1".',
      verification: 'Generated ZPL contains correct item data. Label prints match preview.',
      validation: 'Printed labels are legible, accurately identify the item, and scan correctly.' },

    // Section 1.8 - Records & Data Integrity
    { reqId: 'REQ-SYS-RD-001', cat: 'Records & Data Integrity', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall maintain a Device History Record (DHR) for all manufactured products.',
      rationale: '21 CFR 820.184 requires a DHR including dates of manufacture, quantity, acceptance records.',
      parameter: 'DHR is the composite of: harness revision history, order history, barcode history, task history.',
      verification: 'All history tables are insert-only. Complete DHR reconstructable for any product.',
      validation: 'For any manufactured item, a complete DHR can be assembled from system records.' },
    { reqId: 'REQ-SYS-RD-002', cat: 'Records & Data Integrity', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall maintain a Design History File (DHF) for each wire harness design.',
      rationale: '21 CFR 820.30(j) requires a Design History File (DHF) for each type of device.',
      parameter: 'DHF is the composite of: HarnessRevisionHistory, release state transitions, and revision chain.',
      verification: 'Complete design history exists for all released harness designs.',
      validation: 'Auditor can reconstruct the complete design evolution for any harness.' },
    { reqId: 'REQ-SYS-RD-003', cat: 'Records & Data Integrity', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall ensure data integrity through authentication, user attribution, and timestamping of all records.',
      rationale: '21 CFR 820.180 and 21 CFR Part 11 (electronic records) principles require ALCOA records.',
      parameter: 'All records include createdAt and updatedAt timestamps. All user-facing actions record userID.',
      verification: 'All records contain non-null createdAt, updatedAt. All action records contain non-null userID.',
      validation: 'Records satisfy ALCOA principles.' },

    // Section 1.9 - Operational Risk Management
    { reqId: 'REQ-SYS-ORM-001', cat: 'Operational Risk Management', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall support operational risk identification and mitigation by providing task types that distinguish risk-critical activities.',
      rationale: 'AS9100D §8.1.1 requires planning and management of operational risks.',
      parameter: 'Task taskTypeEnum includes critical_path for risk-critical activities. Scheduled tasks automate recurring risk-mitigation activities.',
      verification: 'Critical path tasks are visually distinguished. Scheduled risk-mitigation tasks execute on schedule.',
      validation: 'Operational risks are tracked and mitigated through planned activities in the task system.' },

    // Section 1.10 - Configuration Management
    { reqId: 'REQ-SYS-CM-001', cat: 'Configuration Management', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall maintain configuration management for wire harness designs.',
      rationale: 'AS9100D §8.1.2 requires configuration management ensuring product integrity.',
      parameter: 'Configuration identity: unique part number and revision letter. Configuration baseline: released harness designs are frozen. Configuration change control: edits create new revisions.',
      verification: 'Each harness has unique part number and revision. Released configurations are immutable.',
      validation: 'Auditor can identify the exact configuration baseline for any released harness.' },
    { reqId: 'REQ-SYS-CM-002', cat: 'Configuration Management', parent: 'REQ-SYS-CM-001',
      description: 'The system shall maintain configuration management for parts by tracking part identity, vendor, manufacturer, and specification attributes.',
      rationale: 'AS9100D §8.1.2 requires configuration identification and control.',
      parameter: 'Part model includes: name (unique), vendor, SKU, manufacturer, manufacturerPN, partCategory, serial/lot requirements.',
      verification: 'Parts have unique names. Vendor parts have manufacturer traceability.',
      validation: 'Any part used in production can be traced to its complete specification.' },

    // Section 1.11 - Product Safety
    { reqId: 'REQ-SYS-PS-001', cat: 'Product Safety', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall support product safety by enforcing design review gates, maintaining traceability, and ensuring manufacturing uses only approved designs.',
      rationale: 'AS9100D §8.1.3 requires organizations to plan, implement, and control processes for product safety.',
      parameter: 'Design review gates prevent unapproved designs from reaching production. Full traceability from part receipt through final assembly.',
      verification: 'No unapproved design can be used for production. All safety-critical parts have serial/lot traceability.',
      validation: 'Safety audit confirms only released designs are used in production.' },

    // Section 1.12 - Counterfeit Parts Prevention
    { reqId: 'REQ-SYS-CP-001', cat: 'Counterfeit Parts Prevention', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall support counterfeit parts prevention by maintaining manufacturer traceability for all vendor-sourced parts.',
      rationale: 'AS9100D §8.1.4 requires processes for prevention of counterfeit parts.',
      parameter: 'Vendor parts require manufacturer and manufacturer part number. Parts linked to vendor and SKU. Order records track vendor and receiving details.',
      verification: 'No vendor part can be created without manufacturer data. Complete provenance chain is reconstructable.',
      validation: 'For any part in inventory, auditor can trace provenance from manufacturer through vendor to current location.' },

    // Section 1.13 - External Providers
    { reqId: 'REQ-SYS-EP-001', cat: 'External Providers', parent: 'REQ-SYS-PC-001',
      description: 'The system shall support evaluation and monitoring of external providers through order status tracking and receiving inspection records.',
      rationale: 'AS9100D §8.4.1 requires evaluation and monitoring of external providers.',
      parameter: 'Orders track vendor identity, order status progression, and receiving outcomes. Historical order data enables vendor performance analysis.',
      verification: 'Orders record vendor identity. Receiving discrepancies are tracked.',
      validation: 'Quality team can review vendor order history and delivery performance.' },

    // Section 1.14 - Production Process Verification
    { reqId: 'REQ-SYS-PV-001', cat: 'Production Process Verification', parent: 'REQ-SYS-PP-001',
      description: 'The system shall support first article inspection and production process verification.',
      rationale: 'AS9100D §8.5.1.3 requires production process verification activities including FAI per AS9102.',
      parameter: 'First article inspection tracked as critical_path task type linked to the relevant harness design revision.',
      verification: 'FAI tasks created for new design revisions. FAI completion recorded with traceability.',
      validation: 'For each released design revision, evidence of first article inspection is traceable.' },

    // Section 1.15 - Nonconforming Product
    { reqId: 'REQ-SYS-NC-001', cat: 'Nonconforming Product', parent: 'REQ-SYS-QMS-001',
      description: 'The system shall support identification and control of nonconforming product through inventory status management, quarantine via location assignment, and soft deletion.',
      rationale: 'AS9100D §8.7 requires identification, documentation, segregation, and disposition of nonconforming outputs.',
      parameter: 'Quarantine via barcode move to designated quarantine location. Disposition options: rework, scrap, or use-as-is. All disposition actions recorded in barcode history.',
      verification: 'Nonconforming items can be moved to quarantine locations. All disposition actions create history records.',
      validation: 'Auditor can trace any nonconforming product from identification through disposition.' },

    // Section 2 - Authentication
    { reqId: 'REQ-AUTH-001', cat: 'Authentication', parent: 'REQ-SYS-001',
      description: 'The system shall authenticate users via Google OAuth 2.0.',
      rationale: 'Leverages existing Google accounts for SSO. No custom password management required.',
      parameter: 'Google OAuth with GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET. Passport.js GoogleStrategy.',
      verification: 'GET /api/auth/google redirects to Google OAuth consent screen.',
      validation: 'User can click "Login with Google", authenticate, and be redirected back to the application.' },
    { reqId: 'REQ-AUTH-002', cat: 'Authentication', parent: 'REQ-AUTH-001',
      description: 'The system shall issue JWT access tokens upon successful authentication.',
      rationale: 'Stateless authentication for API requests.',
      parameter: 'JWT signed with JWT_SECRET. Payload: { id, displayName, email }. Token sent in Authorization: Bearer header.',
      verification: 'GET /api/auth/user/checkToken returns 200 for valid token, 401 for invalid/expired.',
      validation: 'Authenticated requests succeed. Unauthenticated requests return 401.' },
    { reqId: 'REQ-AUTH-003', cat: 'Authentication', parent: 'REQ-AUTH-001',
      description: 'The system shall support JWT token refresh using httpOnly refresh tokens stored as cookies.',
      rationale: 'Extends session duration without requiring re-login.',
      parameter: 'Refresh token: 64-char random string stored in RefreshTokens table. Sent as httpOnly cookie.',
      verification: 'POST /api/auth/user/refresh returns new accessToken.',
      validation: 'When access token expires, frontend interceptor automatically refreshes.' },
    { reqId: 'REQ-AUTH-004', cat: 'Authentication', parent: 'REQ-AUTH-001',
      description: 'The system shall protect all API endpoints (except auth) with token authentication middleware.',
      rationale: 'Prevents unauthorized access to application data.',
      parameter: 'checkToken middleware on all non-auth routes. Validates JWT, loads user from database, verifies activeFlag: true.',
      verification: 'Requests without Authorization header return 401.',
      validation: 'All protected pages redirect to login when not authenticated.' },
    { reqId: 'REQ-AUTH-005', cat: 'Authentication', parent: 'REQ-AUTH-001',
      description: 'The system shall allow users to view and update their profile information.',
      rationale: 'Users may need to update display preferences.',
      parameter: 'GET /api/auth/user returns user profile. PUT /api/auth/user updates user fields.',
      verification: 'Backend test: auth.test.js getUser and updateUser tests.',
      validation: 'User can see their name and email. User can update display name.' },
    { reqId: 'REQ-AUTH-006', cat: 'Authentication', parent: 'REQ-AUTH-001',
      description: 'The system shall support a Google Add-on token exchange for calendar integration.',
      rationale: 'Enables Google Workspace Add-on to authenticate against the API.',
      parameter: 'POST /api/auth/addon/token accepts Google ID token, verifies with Google, returns Letwinventory JWT.',
      verification: 'Endpoint accepts valid Google ID token and returns JWT.',
      validation: 'Google Add-on can authenticate and create task time tracking entries.' },
    { reqId: 'REQ-AUTH-007', cat: 'Authentication', parent: 'REQ-AUTH-001',
      description: 'The frontend shall provide an auth guard that redirects unauthenticated users to the login page.',
      rationale: 'Prevents access to protected routes without valid session.',
      parameter: 'authGuard checks AuthService.isAuthenticated() signal. Redirects to /home if not authenticated.',
      verification: 'Unit test: guard returns false and navigates to /home when not authenticated.',
      validation: 'Manually navigating to a protected URL without login redirects to home page.' },
    { reqId: 'REQ-AUTH-008', cat: 'Authentication', parent: 'REQ-AUTH-003',
      description: 'The frontend shall automatically retry failed requests after token refresh on 401 responses.',
      rationale: 'Seamless user experience when tokens expire during active session.',
      parameter: 'authInterceptor catches 401, calls refresh endpoint, queues concurrent requests, retries after refresh succeeds. 403 responses clear token and redirect.',
      verification: 'Unit test: interceptor retries request after successful refresh.',
      validation: 'User does not see login prompt during normal usage when refresh token is valid.' },

    // Section 3 - Inventory
    { reqId: 'REQ-INV-001', cat: 'Inventory', parent: 'REQ-SYS-001',
      description: 'The system shall provide a hierarchical inventory structure of Locations, Boxes, Traces (parts), and Equipment, each identified by a unique barcode.',
      rationale: 'Physical warehouse organization requires nested container structure with barcode tracking.',
      parameter: 'Hierarchy: Locations contain Boxes/Traces/Equipment. Each entity has a barcodeID linking to a unique Barcode record.',
      verification: 'Backend tests verify Location, Box, Trace, Equipment CRUD operations.',
      validation: 'User can navigate the inventory tree view, expanding locations to see contained items.' },
    { reqId: 'REQ-INV-002', cat: 'Inventory', parent: 'REQ-INV-001',
      description: 'The system shall display inventory in a tree view with expand/collapse navigation.',
      rationale: 'Intuitive visualization of physical warehouse layout.',
      parameter: 'Frontend InventoryHierarchyView component. Search filters by name/barcode/part number. Deep linking via ?barcode=<id>.',
      verification: 'Backend test: location hierarchy endpoint returns tree structure.',
      validation: 'User can expand locations, see nested boxes and parts, search for items.' },
    { reqId: 'REQ-INV-003', cat: 'Inventory', parent: 'REQ-INV-001',
      description: 'The system shall support CRUD operations for Locations.',
      rationale: 'Users need to create and manage physical storage locations.',
      parameter: 'Location model: name (STRING 16), description (STRING 62), barcodeID (FK, unique). Create auto-generates barcode with LOC prefix.',
      verification: 'Backend tests: location.test.js - get by ID, update location.',
      validation: 'User can create a new location in the inventory dialog and see it in the tree.' },
    { reqId: 'REQ-INV-004', cat: 'Inventory', parent: 'REQ-INV-001',
      description: 'The system shall support CRUD operations for Boxes.',
      rationale: 'Boxes are containers within locations for organizing smaller items.',
      parameter: 'Box model: name (STRING 16), description (STRING 62), barcodeID (FK, unique). Create auto-generates barcode with BOX prefix.',
      verification: 'Backend tests: box.test.js - get by ID, update box.',
      validation: 'User can create a box within a location and see it nested in the tree.' },
    { reqId: 'REQ-INV-005', cat: 'Inventory', parent: 'REQ-INV-001',
      description: 'The system shall support CRUD operations for Traces (inventory items with quantity tracking).',
      rationale: 'Traces represent physical stock of parts with quantities, serial numbers, and lot numbers.',
      parameter: 'Trace model: partID (FK, not null), quantity (FLOAT, not null). Supports split, merge, and partial deletion.',
      verification: 'Backend tests: trace.test.js - get by part ID, get by ID, update, delete by barcode.',
      validation: 'User can see part quantities in the tree, split a trace, merge traces, and delete inventory.' },
    { reqId: 'REQ-INV-005A', cat: 'Inventory', parent: 'REQ-INV-005',
      description: 'The system shall allow splitting a trace into two separate traces.',
      rationale: 'Enables dividing inventory when moving partial quantities to different locations.',
      parameter: 'POST /api/inventory/trace/split/:barcodeId with { splitQuantity }.',
      verification: 'Backend test: split trace (PostgreSQL-specific).',
      validation: 'User can split a trace and see two separate items with correct quantities.' },
    { reqId: 'REQ-INV-005B', cat: 'Inventory', parent: 'REQ-INV-005',
      description: 'The system shall allow merging two traces of the same part.',
      rationale: 'Consolidates inventory when combining stock from different locations.',
      parameter: 'POST /api/inventory/trace/merge/:barcodeId with { mergeBarcodeId }. Validates same partID.',
      verification: 'Test: merge endpoint combines quantities and deactivates source.',
      validation: 'User can merge two traces of the same part into one.' },
    { reqId: 'REQ-INV-005C', cat: 'Inventory', parent: 'REQ-INV-005',
      description: 'The system shall allow partial or full deletion of trace inventory.',
      rationale: 'Accounts for consumed, damaged, or lost inventory.',
      parameter: 'DELETE /api/inventory/trace/barcode/:barcodeId with optional { deleteQuantity }.',
      verification: 'Backend test: delete trace by barcode.',
      validation: 'User can reduce or fully remove inventory from the system.' },
    { reqId: 'REQ-INV-006', cat: 'Inventory', parent: 'REQ-INV-001',
      description: 'The system shall support CRUD operations for Equipment with serial number and commission date tracking.',
      rationale: 'Equipment requires individual tracking beyond simple quantity counts.',
      parameter: 'Equipment model: name, serialNumber, commissionDate (DATEONLY), barcodeID, partID, orderItemID.',
      verification: 'Backend tests: equipment.test.js - list, get by ID, update, delete.',
      validation: 'User can create equipment, assign serial numbers, track commission dates.' },
    { reqId: 'REQ-INV-007', cat: 'Inventory', parent: 'REQ-INV-001',
      description: 'The system shall maintain reference data for Units of Measure.',
      rationale: 'Parts can be measured in different units (each, grams, gallons, etc.).',
      parameter: 'Seeded values: ea (Each), gal (Gallon), g (Gram), kg (Kilogram).',
      verification: 'Backend test: unitOfMeasure.test.js - list returns seeded values.',
      validation: 'UoM dropdown in part/trace forms shows available units.' },

    // Section 4 - Barcode
    { reqId: 'REQ-BAR-001', cat: 'Barcode', parent: 'REQ-INV-001',
      description: 'The system shall auto-generate unique barcode strings in the format PREFIX-XXXXXX (hex) for each new barcode-tracked entity.',
      rationale: 'Unique machine-readable identifiers for all physical items.',
      parameter: 'Categories: AKL (parts/traces), LOC (locations), BOX (boxes), EQP (equipment). Barcode generation via PostgreSQL sequence.',
      verification: 'Backend tests: barcode.test.js - list barcodes, categories, lookup by string.',
      validation: 'Each new location/box/trace/equipment receives a unique barcode string.' },
    { reqId: 'REQ-BAR-002', cat: 'Barcode', parent: 'REQ-BAR-001',
      description: 'The system shall support barcode lookup by barcode string.',
      rationale: 'Scanning a barcode needs to resolve to the associated item.',
      parameter: 'GET /api/inventory/barcode/lookup/:barcode returns barcode with category. Returns 404 for nonexistent.',
      verification: 'Backend test: lookup returns barcode data, 404 for nonexistent.',
      validation: 'Scanning or entering a barcode string retrieves the correct item.' },
    { reqId: 'REQ-BAR-003', cat: 'Barcode', parent: 'REQ-BAR-001',
      description: 'The system shall support moving barcodes between parent locations.',
      rationale: 'Items are physically moved between locations in the warehouse.',
      parameter: 'POST /api/inventory/barcode/move/:id with { newLocationID }. Records MOVED action in barcode history.',
      verification: 'Backend test: move barcode (PostgreSQL-specific).',
      validation: 'User can move an item to a different location and see it in the new location\'s tree.' },
    { reqId: 'REQ-BAR-004', cat: 'Barcode', parent: 'REQ-BAR-001',
      description: 'The system shall maintain a complete history of barcode actions.',
      rationale: 'Audit trail for inventory movement, receipt, split, merge, and deletion.',
      parameter: 'BarcodeHistory model with action types: CREATED, MOVED, RECEIVED, SPLIT, MERGED, DELETED.',
      verification: 'Backend tests: barcodeHistory.test.js - list all, action types, by barcode.',
      validation: 'User can view the full movement/action history timeline for any barcode.' },
    { reqId: 'REQ-BAR-005', cat: 'Barcode', parent: 'REQ-BAR-001',
      description: 'The system shall generate ZPL label code for barcode printing in 3x1 and 1.5x1 inch label sizes.',
      rationale: 'Physical barcode labels needed for warehouse items.',
      parameter: 'GET /api/inventory/barcode/display/:id?labelSize=3x1 returns ZPL string. Includes QR code, company branding, item name.',
      verification: 'Endpoint returns valid ZPL string for each barcode type.',
      validation: 'User can preview barcode labels in the dialog.' },
    { reqId: 'REQ-BAR-006', cat: 'Barcode', parent: 'REQ-BAR-001',
      description: 'The system shall support printing barcodes to Zebra label printers via direct TCP or WebSocket print agent.',
      rationale: 'Automated label printing reduces manual label creation.',
      parameter: 'POST /api/inventory/barcode/print/:id with { labelSize, printerIP }. Prefers WebSocket print agent if connected, falls back to direct TCP.',
      verification: 'Print endpoint generates ZPL and sends to printer.',
      validation: 'User clicks "Print" in barcode dialog and physical label prints on Zebra printer.' },
    { reqId: 'REQ-BAR-006A', cat: 'Barcode', parent: 'REQ-BAR-006',
      description: 'The system shall support a WebSocket-based print agent for remote printing.',
      rationale: 'Enables printing when the server is not on the same network as the printer.',
      parameter: 'WebSocket endpoint at /ws/print-agent. Agent authenticates with API key. Heartbeat every 60s.',
      verification: 'Print agent connects, authenticates, receives print jobs, reports results.',
      validation: 'Labels print successfully via the print agent from a remote network.' },
    { reqId: 'REQ-BAR-007', cat: 'Barcode', parent: 'REQ-BAR-001',
      description: 'The system shall provide a barcode tag system that resolves barcodes to their associated items with type information.',
      rationale: 'Enables displaying human-readable information for any scanned barcode.',
      parameter: 'GET /api/inventory/barcode/tag/:id returns { id, barcodeID, barcode, type, name, description }.',
      verification: 'Tag endpoint resolves barcode to item with correct type.',
      validation: 'Scanning a barcode displays the item name, type, and location chain.' },

    // Section 5 - Parts
    { reqId: 'REQ-PRT-001', cat: 'Parts', parent: 'REQ-SYS-001',
      description: 'The system shall support CRUD operations for parts with categories, vendor information, and manufacturer details.',
      rationale: 'Parts catalog is the foundation of inventory.',
      parameter: 'Part model: name (unique), description, internalPart, vendor, sku, manufacturer, manufacturerPN, imageFileID.',
      verification: 'Backend tests: part.test.js - list, categories, get by ID, create, update, delete.',
      validation: 'User can browse, create, edit, and delete parts with all fields.' },
    { reqId: 'REQ-PRT-002', cat: 'Parts', parent: 'REQ-PRT-001',
      description: 'The system shall require manufacturer and manufacturer part number for vendor (non-internal) parts.',
      rationale: 'Vendor parts must be traceable to their manufacturer.',
      parameter: 'Controller validates !internalPart → manufacturer && manufacturerPN required. Returns 400 if missing.',
      verification: 'Backend test: create part with internalPart=false requires manufacturer fields.',
      validation: 'Creating a vendor part without manufacturer info shows validation error.' },
    { reqId: 'REQ-PRT-003', cat: 'Parts', parent: 'REQ-PRT-001',
      description: 'The system shall support part categories with color-coded tags.',
      rationale: 'Categorization helps organize and filter the parts catalog.',
      parameter: 'PartCategory model: name (unique), tagColorHex (STRING 7, default #808080).',
      verification: 'Backend test: categories endpoint returns seeded values.',
      validation: 'Parts table shows colored category chips. Category filter dropdown works.' },
    { reqId: 'REQ-PRT-004', cat: 'Parts', parent: 'REQ-PRT-001',
      description: 'The system shall support part image uploads and hover preview in the parts table.',
      rationale: 'Visual identification of parts speeds up inventory operations.',
      parameter: 'Part has imageFileID FK to UploadedFile. Frontend parts table shows image icon column.',
      verification: 'Part with imageFileID returns image data in API response.',
      validation: 'User can upload an image to a part and see it in the hover preview.' },
    { reqId: 'REQ-PRT-005', cat: 'Parts', parent: 'REQ-PRT-001',
      description: 'The system shall validate part request bodies against the model schema using body validator middleware.',
      rationale: 'Prevents invalid data from reaching the database.',
      parameter: 'bodyValidator.part middleware on POST and PUT routes.',
      verification: 'Backend test: create/update with valid data succeeds, invalid data returns 400.',
      validation: 'Submitting a part form with invalid data shows appropriate error messages.' },
    { reqId: 'REQ-PRT-006', cat: 'Parts', parent: 'REQ-PRT-001',
      description: 'The parts table shall support search, filtering, sorting, pagination, and URL query parameter persistence.',
      rationale: 'Large parts catalogs need efficient navigation.',
      parameter: 'Search across name/description/vendor/SKU. Filter by category (multi-select), type (internal/vendor). URL syncs parameters.',
      verification: 'Frontend test: parts-table-view.spec.ts (search, filter, pagination, sorting).',
      validation: 'User can search, filter by category, sort by column, paginate, and share the URL.' },
    { reqId: 'REQ-PRT-007', cat: 'Parts', parent: 'REQ-PRT-001',
      description: 'The part edit page shall remain on the current part after saving (not navigate away).',
      rationale: 'Users often make iterative edits and navigating away breaks the workflow.',
      parameter: 'Update success handler calls loadPart(partId) and exits edit mode.',
      verification: 'After PUT request, page remains on the same part ID.',
      validation: 'User edits a part, clicks save, and remains on the same part page.' },

    // Section 6 - Orders
    { reqId: 'REQ-ORD-001', cat: 'Orders', parent: 'REQ-SYS-001',
      description: 'The system shall support CRUD operations for purchase orders with status workflow, line items, and vendor tracking.',
      rationale: 'Procurement workflow from order placement through receiving.',
      parameter: 'Order model: description, vendor, trackingNumber, link, notes, placedDate, receivedDate, orderStatusID.',
      verification: 'Backend tests: order.test.js - list, statuses, line types, get by ID, create, update, delete.',
      validation: 'User can create orders, track status, and manage the full procurement lifecycle.' },
    { reqId: 'REQ-ORD-002', cat: 'Orders', parent: 'REQ-ORD-001',
      description: 'The system shall maintain order statuses with workflow progression.',
      rationale: 'Orders progress through defined stages: Draft → Pending → Placed → Shipped → Received.',
      parameter: 'OrderStatus model: name (unique), tagColor (STRING 7), nextStatusID (FK self-reference).',
      verification: 'Backend test: statuses endpoint returns >= 4 statuses with Draft first.',
      validation: 'Order status chips display with correct colors.' },
    { reqId: 'REQ-ORD-003', cat: 'Orders', parent: 'REQ-ORD-001',
      description: 'The system shall support order line items with quantity, price, and part linkage.',
      rationale: 'Orders contain multiple items, each referencing a part with pricing.',
      parameter: 'OrderItem model: orderID, partID, quantity (INT), price (DECIMAL 10,5), receivedQuantity (INT).',
      verification: 'Backend tests: orderItem.test.js - list by order, create, update, delete.',
      validation: 'User can add, edit, and remove line items from an order.' },
    { reqId: 'REQ-ORD-004', cat: 'Orders', parent: 'REQ-ORD-001',
      description: 'The system shall auto-recalculate order status based on received quantities of line items.',
      rationale: 'Order status should reflect actual receiving progress.',
      parameter: 'recalculateOrderStatus() called on orderItem update.',
      verification: 'After updating receivedQuantity to match quantity for all items, order status advances.',
      validation: 'Receiving all items on an order automatically updates the order status.' },
    { reqId: 'REQ-ORD-005', cat: 'Orders', parent: 'REQ-ORD-001',
      description: 'The system shall support bulk CSV import of orders with dry-run preview.',
      rationale: 'Large orders from vendors can be imported from spreadsheet exports.',
      parameter: 'POST /api/inventory/order/bulk-import with { csvContent, vendor }. ?dryRun=true returns preview.',
      verification: 'Backend tests: order.test.js - dry run preview, execute import.',
      validation: 'User uploads CSV, sees preview with existing/new parts, confirms to create order.' },
    { reqId: 'REQ-ORD-006', cat: 'Orders', parent: 'REQ-ORD-001',
      description: 'The system shall support receiving order items into inventory with barcode and location assignment.',
      rationale: 'Incoming parts need to be added to inventory with physical location tracking.',
      parameter: 'Frontend ReceiveLineItemDialog enables scanning barcode, selecting location, entering quantity.',
      verification: 'After receiving, Trace/Equipment record exists with correct barcode and parent location.',
      validation: 'User clicks "Receive" on an order item, assigns location, and item appears in inventory tree.' },
    { reqId: 'REQ-ORD-007', cat: 'Orders', parent: 'REQ-ORD-001',
      description: 'The orders list view shall support search, status filtering, sorting, pagination, and URL query parameter persistence.',
      rationale: 'Efficient navigation and shareable views for order management.',
      parameter: 'Search, filter by status (multi-select), default sort: placedDate descending. URL syncs: search, statuses, sort, dir, page, pageSize.',
      verification: 'Frontend test: orders-list-view.spec.ts (search, filter, pagination, sorting).',
      validation: 'User can filter orders by status, search, and share the URL with filters applied.' },

    // Section 7 - Wire Harness
    { reqId: 'REQ-HAR-001', cat: 'Wire Harness', parent: 'REQ-SYS-001',
      description: 'The system shall provide a canvas-based wire harness schematic editor for designing cable assemblies.',
      rationale: 'Wire harness design requires visual placement of connectors, cables, and wiring between pins.',
      parameter: 'HTML5 Canvas 2D rendering. Elements: Connectors, Cables, Components, Sub-harnesses. Data stored as JSONB harnessData.',
      verification: 'Backend tests: harness.test.js - list, get by ID, create, update, delete, next part number.',
      validation: 'User can open the harness editor, place elements, draw wires, and save the design.' },
    { reqId: 'REQ-HAR-002', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support adding, positioning, rotating, and flipping connectors.',
      rationale: 'Connectors are the primary elements in a harness design.',
      parameter: 'ElectricalConnector model: label, type (male/female/terminal/splice), pinCount, pins, partID.',
      verification: 'Backend tests: connector.test.js - list, pin types, get by ID/part, create, update, delete.',
      validation: 'User can add a connector, rotate it, and see pins rendered with correct positions.' },
    { reqId: 'REQ-HAR-003', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support adding and editing multi-wire cables.',
      rationale: 'Cables bundle multiple wires and need visual representation.',
      parameter: 'Cable model: label, wireCount, gaugeAWG, wires (JSONB array of {id, color, colorCode}), partID.',
      verification: 'Backend tests: cable.test.js - list, get by ID/part, create, update, delete.',
      validation: 'User can add a cable and see individual wire endpoints for connection.' },
    { reqId: 'REQ-HAR-004', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support adding electrical components with pin groups.',
      rationale: 'Components like ICs, resistors need pin representation for wiring.',
      parameter: 'ElectricalComponent model: label, pinCount, pins (JSONB array of pin groups with pins), partID.',
      verification: 'Backend tests: component.test.js - list, get by ID/part, create, update, delete.',
      validation: 'User can add a component and wire to its pins.' },
    { reqId: 'REQ-HAR-005', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support drawing wire connections between element pins with orthogonal routing.',
      rationale: 'Wires must visually connect pins with clean right-angle paths.',
      parameter: 'Wire drawing mode activated by tool selection. Orthogonal path calculation with obstacle avoidance. Wire properties: color, gauge, length, termination types.',
      verification: 'Connection data stored in harnessData.connections JSONB array.',
      validation: 'User can draw a wire from connector pin A to connector pin B and see an orthogonal path.' },
    { reqId: 'REQ-HAR-006', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support connector mating connections (direct connector-to-connector).',
      rationale: 'Mating connectors connect directly without individual wire routing.',
      parameter: 'Mating connections: connectionType mating. Backend validates mating connections are between two connectors only.',
      verification: 'Backend validation rejects mating connections to non-connector elements.',
      validation: 'User can create a mating connection between two connectors via mating points.' },
    { reqId: 'REQ-HAR-007', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support wire termination types from the WireEnd database.',
      rationale: 'Wire ends have specific termination types (pin, spade, ring, ferrule, etc.).',
      parameter: 'WireEnd model: code, name, description. Seeded: f-pin, m-pin, f-spade, m-spade, ring, fork, ferrule, soldered, bare.',
      verification: 'Backend tests: wireEnd.test.js - list, by code, by ID, create, update, delete.',
      validation: 'Property panel shows termination type dropdowns populated from the database.' },
    { reqId: 'REQ-HAR-008', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support sub-harness references (nested assemblies).',
      rationale: 'Complex harnesses reuse sub-assemblies and need hierarchical composition.',
      parameter: 'SubHarnessRef stored in harnessData.subHarnesses JSONB. Backend validates: cycle detection, reference validation, delete protection.',
      verification: 'Backend tests: sub-harness data fetch, parent harnesses, cycle detection.',
      validation: 'User can add a sub-harness and see it rendered on the canvas.' },
    { reqId: 'REQ-HAR-009', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support undo/redo with maximum 50 history entries.',
      rationale: 'Design operations need to be reversible.',
      parameter: 'HarnessHistoryService with past/future stacks. Keyboard: Ctrl+Z (undo), Ctrl+Y (redo).',
      verification: 'Service unit test: push/undo/redo maintain correct stack state.',
      validation: 'User makes changes, presses Ctrl+Z to undo, Ctrl+Y to redo.' },
    { reqId: 'REQ-HAR-010', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall auto-save changes with a 1.5-second debounce.',
      rationale: 'Prevents data loss from unsaved work while avoiding excessive API calls.',
      parameter: 'Auto-save triggers on any data change after 1.5s idle.',
      verification: 'After data change, API call fires within debounce window.',
      validation: 'User makes a change, navigates away, returns — changes are persisted.' },
    { reqId: 'REQ-HAR-011', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support element grouping and ungrouping via context menu.',
      rationale: 'Groups allow moving related elements together.',
      parameter: 'Context menu: "Group Selected" (multiple items selected), "Ungroup" (grouped item selected).',
      verification: 'Grouping stores group data in harnessData.',
      validation: 'User selects multiple elements, right-clicks, groups them, then moves them together.' },
    { reqId: 'REQ-HAR-012', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor canvas shall support pan, zoom, grid display, and snap-to-grid.',
      rationale: 'Navigation and alignment tools for schematic editing.',
      parameter: 'Tools: Pan (drag canvas), Zoom (scroll wheel). Grid toggle. Snap-to-grid toggle.',
      verification: 'Canvas renders grid lines when enabled. Element positions snap to grid increments.',
      validation: 'User can pan/zoom the canvas, toggle grid, and elements snap to grid positions.' },
    { reqId: 'REQ-HAR-013', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness system shall enforce a release workflow: Draft → Review → Released.',
      rationale: 'Engineering change control requires formal review before designs are frozen.',
      parameter: 'WireHarness.releaseState: draft | review | released. Endpoints: submit-review, reject, release.',
      verification: 'Backend tests: harness.test.js - submit for review, reject, release, history, revisions.',
      validation: 'User clicks "Release" button, harness transitions through review states, released harness locks editing.' },
    { reqId: 'REQ-HAR-014', cat: 'Wire Harness', parent: 'REQ-HAR-013',
      description: 'Released harnesses shall be read-only with all editing tools disabled.',
      rationale: 'Released designs are frozen for manufacturing use.',
      parameter: 'isReleased signal disables: wire tool, node edit, add elements, rotate, flip, delete, undo/redo, import.',
      verification: 'All editing operations are no-ops when isReleased=true.',
      validation: 'User cannot modify a released harness. All edit controls appear disabled.' },
    { reqId: 'REQ-HAR-015', cat: 'Wire Harness', parent: 'REQ-HAR-013',
      description: 'The system shall create a new revision when editing a released harness.',
      rationale: 'Design updates to released harnesses must be tracked as new revisions.',
      parameter: 'Revisions increment alphabetically: A → B → C → ... → Z → AA → AB.',
      verification: 'Backend tests: revision history, all revisions, revert to snapshot.',
      validation: 'User clicks "New Revision", new harness created as Rev B.' },
    { reqId: 'REQ-HAR-016', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness list view shall display release status with color-coded chips and support search, sorting, and pagination.',
      rationale: 'Users need to see design status at a glance.',
      parameter: 'Status chips: draft (gray), review (orange), released (green). Search, sort, pagination. URL query param persistence.',
      verification: 'Frontend test: harness-list-view.spec.ts (data loading, search, sorting, pagination).',
      validation: 'User sees harness list with color-coded status and can filter/sort.' },
    { reqId: 'REQ-HAR-017', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support import/export of harness designs as JSON.',
      rationale: 'Enables backup, sharing, and migration of harness designs.',
      parameter: 'Export: serializes harnessData to JSON file. Import: loads JSON via HarnessImportDialog.',
      verification: 'Exported JSON can be re-imported to produce identical canvas.',
      validation: 'User exports a harness, imports it into a new harness, and sees identical design.' },
    { reqId: 'REQ-HAR-018', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The harness backend shall validate harness data for structural integrity.',
      rationale: 'Prevents invalid designs from being saved.',
      parameter: 'POST /api/parts/harness/validate checks: sub-harness cycle detection, reference validation, mating connections.',
      verification: 'Backend test: validate endpoint with valid/invalid data.',
      validation: 'Saving a harness with circular sub-harness references shows validation error.' },
    { reqId: 'REQ-HAR-019', cat: 'Wire Harness', parent: 'REQ-HAR-001',
      description: 'The system shall strip base64-encoded image data from harness JSON before saving and re-fetch images on load.',
      rationale: 'Inline base64 images bloat the harnessData JSONB column.',
      parameter: 'Fields stripped: connectorImage, pinoutDiagramImage, cableDiagramImage, componentImage. On load, syncPartsFromDatabase() fetches images.',
      verification: 'Backend test: saved harnessData does not contain base64 image strings.',
      validation: 'User saves a harness with connector images, reloads — images are still visible.' },
    { reqId: 'REQ-HAR-020', cat: 'Wire Harness', parent: 'REQ-HAR-019',
      description: 'The system shall synchronize harness element properties from the parts database on load.',
      rationale: 'Parts may be updated independently of harness designs.',
      parameter: 'On harness load, for each element with a partId, the system fetches the current part record. Structural changes presented in sync dialog.',
      verification: 'Backend test: by-part endpoints include Part.imageFile in response.',
      validation: 'User updates a connector pin count, opens a harness using that connector, and sees a sync prompt.' },
    { reqId: 'REQ-HAR-021', cat: 'Wire Harness', parent: 'REQ-HAR-008',
      description: 'The harness editor shall display images and pinout diagrams for elements within sub-harnesses.',
      rationale: 'Sub-harness child elements should display their part images.',
      parameter: 'After sub-harness data loads, images are fetched for all child elements with a partId. Expand/collapse buttons toggle visibility.',
      verification: 'E2E test: sub-harness elements with linked parts display images after load.',
      validation: 'User opens a harness containing a sub-harness with imaged connectors; images appear.' },

    // Section 8 - Planning
    { reqId: 'REQ-PLN-001', cat: 'Planning', parent: 'REQ-SYS-001',
      description: 'The system shall provide a Kanban-style task board with drag-and-drop between columns.',
      rationale: 'Visual task management with column-based workflow.',
      parameter: 'TaskList model: name, order. Task model: name, description, doneFlag, dueDate, timeEstimate, taskTypeEnum, rank (DOUBLE). CDK DragDrop.',
      verification: 'Backend tests: task.test.js, taskList.test.js - full CRUD and move operations.',
      validation: 'User sees columns with task cards, can drag cards between columns.' },
    { reqId: 'REQ-PLN-002', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall support task CRUD operations with project assignment, type, priority, due date, and time estimate.',
      rationale: 'Tasks need rich metadata for planning and tracking.',
      parameter: 'POST/GET/PUT/DELETE /api/planning/task. Task includes: ownerUserID, projectID, taskListID, taskTypeEnum, timeEstimate, parentTaskID.',
      verification: 'Backend tests: task types, list, filter, get by ID, create (with history), update, delete.',
      validation: 'User can create, edit, and delete tasks with all fields populated.' },
    { reqId: 'REQ-PLN-003', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall support moving tasks between lists with rank-based ordering.',
      rationale: 'Drag-and-drop requires flexible ordering without renumbering.',
      parameter: 'PUT /api/planning/task/:taskId/move with { taskListId, targetIndex }.',
      verification: 'Backend test: move task changes taskListID and rank.',
      validation: 'User drags task from one column to another, it appears in correct position.' },
    { reqId: 'REQ-PLN-004', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall support task list CRUD with reordering.',
      rationale: 'Users need to create workflow columns and arrange their order.',
      parameter: 'POST /api/planning/tasklist auto-assigns order. PUT /reorder with { orderedIds }.',
      verification: 'Backend tests: taskList.test.js - list, order, create, update, reorder, delete.',
      validation: 'User can create new columns, drag to reorder, rename, and delete.' },
    { reqId: 'REQ-PLN-005', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall support project management with color-coded tags and keyboard shortcuts.',
      rationale: 'Projects group related tasks and enable quick visual identification.',
      parameter: 'Project model: name, shortName, tagColorHex (stored without #), keyboardShortcut (digits 1-9), parentProjectID.',
      verification: 'Backend tests: project.test.js - list, top-level, get by ID, create, update, delete.',
      validation: 'User can create projects with colors and keyboard shortcuts, see colored chips on tasks.' },
    { reqId: 'REQ-PLN-006', cat: 'Planning', parent: 'REQ-PLN-005',
      description: 'The task board shall support keyboard shortcut project assignment on hover.',
      rationale: 'Rapid project assignment without opening dialogs speeds up task triage.',
      parameter: 'Hover over task card + press number key 1-9: assigns project. Press 0: clears project. Toggle behavior.',
      verification: 'Frontend test: task-card.spec.ts (key events, toggle complete, project assignment).',
      validation: 'User hovers over task, presses "1", task shows project 1\'s color chip.' },
    { reqId: 'REQ-PLN-007', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The task board shall support filtering by projects, showing/hiding tasks without projects, and showing/hiding subtasks.',
      rationale: 'Users need to focus on specific projects or task subsets.',
      parameter: 'Sub-toolbar with project chips (multi-select), "No Project" filter, subtasks toggle. Filters persist as URL query params.',
      verification: 'Frontend test: sub-toolbar.spec.ts (project selection, filter count, toggles).',
      validation: 'User selects projects to filter, saves default view, reloads and sees saved filters.' },
    { reqId: 'REQ-PLN-008', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall maintain task history for all state changes.',
      rationale: 'Audit trail for task lifecycle events.',
      parameter: 'TaskHistory model: taskID, userID, actionID. Action types: CREATED, ADD_TO_PROJECT, ADD_PRIORITY, CHANGE_STATUS, MOVE_LIST.',
      verification: 'Backend tests: taskHistory.test.js - list, action types, by task.',
      validation: 'History drawer shows timeline of task movements and changes.' },
    { reqId: 'REQ-PLN-009', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The task detail dialog shall support subtasks, calendar date picker with 15-minute rounding, and time estimates.',
      rationale: 'Detailed task management requires sub-task breakdown and scheduling.',
      parameter: 'TaskCardDialogComponent: subtask list, due date with time picker (rounds to nearest 15 minutes), time estimate input.',
      verification: 'Date picker defaults to current time rounded to 15-min interval.',
      validation: 'User opens task dialog, sets due date, adds subtasks, sets time estimate.' },
    { reqId: 'REQ-PLN-010', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall support scheduled task creation from cron expressions.',
      rationale: 'Recurring tasks need automated creation on a schedule.',
      parameter: 'ScheduledTask model: name, description, taskListID, projectID, cronExpression, timezone, dueDateOffsetHours, nextRunAt.',
      verification: 'Backend tests: scheduledTask.test.js, scheduledTaskService.test.js.',
      validation: 'User creates a scheduled task with cron "0 9 * * 1" (Mon 9am), task appears on Monday morning.' },
    { reqId: 'REQ-PLN-011', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The system shall support task time tracking linked to calendar events.',
      rationale: 'Integrates with Google Calendar Add-on for time tracking.',
      parameter: 'TaskTimeTracking model: taskID, userID, calendarEventID, calendarID.',
      verification: 'Backend tests: taskTimeTracking.test.js - create, delete by ID, delete by event ID.',
      validation: 'Add-on creates time tracking entries visible in the application.' },
    { reqId: 'REQ-PLN-012', cat: 'Planning', parent: 'REQ-PLN-001',
      description: 'The task board shall support mobile-responsive layout with snap-scroll columns and long-press drag.',
      rationale: 'Warehouse users need task management on mobile devices.',
      parameter: 'Columns snap-scroll at max-width: 768px. CDK drag delay: 500ms touch, 0ms mouse. Auto-scroll during drag.',
      verification: 'Mobile viewport renders single column with snap-scroll. Long-press initiates drag.',
      validation: 'On mobile, user swipes between columns, long-presses to drag tasks.' },
    { reqId: 'REQ-PLN-013', cat: 'Planning', parent: 'REQ-PLN-002',
      description: 'Tasks shall support an inline checklist stored as a JSONB column on the Task model.',
      rationale: 'Lightweight checklists enable task decomposition without creating full subtask objects.',
      parameter: 'ChecklistItem { id: string (UUID), text: string, checked: boolean }. Stored as checklist JSONB column.',
      verification: 'Backend tests: task.test.js checklist describe block.',
      validation: 'User opens task dialog, adds checklist items, checks/unchecks them, sees progress badge on task card.' },

    // Section 9 - File Management
    { reqId: 'REQ-FILE-001', cat: 'File Management', parent: 'REQ-SYS-001',
      description: 'The system shall support file upload, storage, and retrieval with base64 encoding.',
      rationale: 'Parts, connectors, and components need associated images and diagrams.',
      parameter: 'UploadedFile model: filename, mimeType, fileSize, data (TEXT, base64), uploadedBy.',
      verification: 'Backend tests: files.test.js - upload, list, get by ID, get data, update, delete.',
      validation: 'User uploads an image to a part, image displays in hover preview and edit page.' },

    // Section 10 - Mobile
    { reqId: 'REQ-MOB-001', cat: 'Mobile', parent: 'REQ-SYS-001',
      description: 'The system shall provide a mobile camera-based barcode scanner for warehouse operations.',
      rationale: 'Hands-free scanning of physical barcodes for inventory operations.',
      parameter: 'Uses BarcodeDetector API (Chrome). Camera feed displayed full-screen. State machine: scanning → loading → display → action.',
      verification: 'Component renders camera feed and detects barcodes.',
      validation: 'User opens scanner on phone, points camera at barcode, item info displays.' },
    { reqId: 'REQ-MOB-002', cat: 'Mobile', parent: 'REQ-MOB-001',
      description: 'The mobile scanner shall support the Move action (scan item, scan destination).',
      rationale: 'Moving items between locations is the most common warehouse operation.',
      parameter: 'Two-scan workflow: scan source → display info → select "Move" → scan destination → confirm → execute.',
      verification: 'After two scans and confirm, moveBarcode API is called with correct IDs.',
      validation: 'User scans a part, scans a shelf location, item moves to that location.' },
    { reqId: 'REQ-MOB-003', cat: 'Mobile', parent: 'REQ-MOB-001',
      description: 'The mobile scanner shall support the Merge action (scan target, scan source).',
      rationale: 'Consolidating inventory of the same part into one location/trace.',
      parameter: 'Two-scan workflow: scan target trace → select "Merge" → scan source trace → confirm → execute. Validates same part.',
      verification: 'After merge, target trace has combined quantity, source is deactivated.',
      validation: 'User scans two traces of the same part, merges them.' },
    { reqId: 'REQ-MOB-004', cat: 'Mobile', parent: 'REQ-MOB-001',
      description: 'The mobile scanner shall support the Split action with quantity input.',
      rationale: 'Dividing inventory when moving partial quantities.',
      parameter: 'Single-scan workflow: scan trace → display info → select "Split" → enter split quantity → confirm.',
      verification: 'After split, original trace reduced, new trace created with split quantity.',
      validation: 'User scans a trace of 100 items, splits 25, sees two traces (75 and 25).' },
    { reqId: 'REQ-MOB-005', cat: 'Mobile', parent: 'REQ-MOB-001',
      description: 'The mobile scanner shall support the Trash action with optional partial quantity.',
      rationale: 'Removing damaged or consumed inventory.',
      parameter: 'Single-scan workflow: scan trace → select "Trash" → optionally enter quantity → confirm.',
      verification: 'After trash, trace quantity reduced or trace deactivated.',
      validation: 'User scans a trace, trashes 5 items, trace quantity decremented by 5.' },
    { reqId: 'REQ-MOB-006', cat: 'Mobile', parent: 'REQ-MOB-001',
      description: 'The mobile scanner shall include a back button for navigation.',
      rationale: 'Mobile users need to exit the scanner without using browser navigation.',
      parameter: 'Circular semi-transparent back button (arrow_back icon) in top-left corner. Uses Location.back().',
      verification: 'Button renders and navigates back.',
      validation: 'User taps back button and returns to previous page.' },

    // Section 11 - Configuration
    { reqId: 'REQ-CFG-001', cat: 'Configuration', parent: 'REQ-BAR-006',
      description: 'The system shall support printer configuration for label printing.',
      rationale: 'Multiple printers may be available for different label sizes.',
      parameter: 'Printer model: name, ipAddress (unique), description, isDefault (BOOLEAN).',
      verification: 'Printers endpoint returns configured printers.',
      validation: 'Printer selection available in barcode print dialog.' },

    // Section 12 - UX
    { reqId: 'REQ-UX-001', cat: 'UX', parent: 'REQ-SYS-001',
      description: 'All list views shall support search, sorting, pagination, and URL query parameter persistence.',
      rationale: 'Consistent navigation patterns and shareable/bookmarkable views.',
      parameter: 'Applies to: Parts, Orders, Equipment, Harness, Projects, Scheduled Tasks. URL syncs: search, inactive, sort, dir, page, pageSize.',
      verification: 'Each list view syncs state to URL query params on change.',
      validation: 'User applies filters, copies URL, opens in new tab, sees same filtered view.' },
    { reqId: 'REQ-UX-002', cat: 'UX', parent: 'REQ-SYS-001',
      description: 'The sidebar navigation shall be collapsible and auto-collapse on mobile devices.',
      rationale: 'Maximize content area on small screens.',
      parameter: 'Sidebar checks window.innerWidth <= 768 on init. Collapsed: width: 0; min-width: 0.',
      verification: 'Sidebar collapses on mobile viewport.',
      validation: 'On mobile, sidebar starts collapsed. User can expand/collapse via toggle.' },
    { reqId: 'REQ-UX-003', cat: 'UX', parent: 'REQ-SYS-001',
      description: 'The system shall display error notifications using Material snackbar.',
      rationale: 'Consistent error/success feedback across the application.',
      parameter: 'ErrorNotificationService with methods for error, success, warning notifications.',
      verification: 'Service displays snackbar with correct type styling.',
      validation: 'User sees snackbar notifications for API errors and successful operations.' },
    { reqId: 'REQ-UX-004', cat: 'UX', parent: 'REQ-HAR-001',
      description: 'The harness editor shall support keyboard shortcuts for common operations.',
      rationale: 'Power users need fast access to editing tools.',
      parameter: 'V: select, H: pan, C: copy, Ctrl+V: paste, Delete: delete selected, Ctrl+Z: undo, Ctrl+Y: redo.',
      verification: 'Key press activates correct tool or operation.',
      validation: 'User presses V to switch to select, H to pan, Ctrl+Z to undo.' },
    { reqId: 'REQ-UX-005', cat: 'UX', parent: 'REQ-BAR-005',
      description: 'The barcode dialog shall support independent preview and print size selection.',
      rationale: 'Users may want to preview at one size but print at another.',
      parameter: 'Separate "Preview Size" and "Print Label Size" dropdowns. Preview updates dynamically on size change.',
      verification: 'Preview re-renders when size changed. Print sends correct size to API.',
      validation: 'User selects 1.5x1 preview, sees small label. Selects 3x1 for print, prints large label.' },
    { reqId: 'REQ-UX-006', cat: 'UX', parent: 'REQ-UX-001',
      description: 'Table rows in list views shall support middle-click to open items in a new browser tab.',
      rationale: 'Power users need to open multiple items simultaneously.',
      parameter: 'auxclick and mousedown event handlers on table rows. Middle-click (button === 1) opens item in new tab.',
      verification: 'E2E test: middle-click dispatched on table row triggers window.open.',
      validation: 'User middle-clicks a part row, new tab opens with the part edit page.' },

    // Section 13 - Notifications
    { reqId: 'REQ-NOTIF-001', cat: 'Notifications', parent: 'REQ-SYS-001',
      description: 'The system shall support web push notifications via the Web Push API with VAPID authentication.',
      rationale: 'Users need real-time alerts for task due dates without keeping the app open.',
      parameter: 'VAPID keys configured per environment. Backend uses web-push library. Service worker handles push events.',
      verification: 'Backend test: vapid-public-key endpoint returns key when configured.',
      validation: 'User enables notifications in browser, receives push notification when a task is due.' },
    { reqId: 'REQ-NOTIF-002', cat: 'Notifications', parent: 'REQ-NOTIF-001',
      description: 'The system shall manage push notification subscriptions per user.',
      rationale: 'Each user/device combination requires a unique push subscription.',
      parameter: 'PushSubscription model: userID, endpoint (unique), p256dh, auth, userAgent.',
      verification: 'Backend test: subscribe creates record, list returns user subscriptions, unsubscribe removes record.',
      validation: 'User subscribes on two devices, sees both in notification settings, removes one.' },
    { reqId: 'REQ-NOTIF-003', cat: 'Notifications', parent: 'REQ-NOTIF-001',
      description: 'The system shall send push notifications for task due date reminders and scheduled task creation.',
      rationale: 'Proactive reminders prevent missed deadlines.',
      parameter: 'Notification service checks every minute for tasks with dueDate within reminder window where dueDateNotifiedAt IS NULL.',
      verification: 'Backend test: due date reminder finds eligible tasks and marks them notified.',
      validation: 'User sets task due in 30 minutes, receives push notification at the configured reminder time.' },

    // Section 14 - Design Requirements
    { reqId: 'REQ-DES-001', cat: 'Design Requirements', parent: 'REQ-SYS-DC-001',
      description: 'The system shall provide CRUD operations for design requirements (create, read, update, soft-delete).',
      rationale: '21 CFR 820.30 and ISO 13485:2016 §7.3 require documented design inputs, outputs, and traceability.',
      parameter: 'DesignRequirements table with fields: id, description, rationale, parameter, verification, validation, ownerUserID, approved, approvedByUserID, activeFlag.',
      verification: 'Backend tests: design-requirement.test.js (POST, GET, PUT, DELETE, 401).',
      validation: 'User can create, view, edit, and delete design requirements through the UI.' },
    { reqId: 'REQ-DES-002', cat: 'Design Requirements', parent: 'REQ-DES-001',
      description: 'Design requirements shall support hierarchical parent-child relationships via parentRequirementID.',
      rationale: 'Requirements naturally decompose into sub-requirements; hierarchy enables traceability.',
      parameter: 'parentRequirementID (INTEGER, nullable, FK → DesignRequirements.id). Self-referencing.',
      verification: 'Backend tests: Hierarchy describe block (child with parentRequirementID, GET returns parent).',
      validation: 'User creates parent and child requirements; tree view displays hierarchy with expand/collapse.' },
    { reqId: 'REQ-DES-003', cat: 'Design Requirements', parent: 'REQ-DES-001',
      description: 'The system shall provide an approval workflow for design requirements (approve/unapprove with user tracking).',
      rationale: '21 CFR 820.30(c) requires design input review and approval.',
      parameter: 'approved (BOOLEAN, default false), approvedByUserID. Endpoints: approve, unapprove.',
      verification: 'Backend tests: Approval describe block (approve, unapprove, associations, 404).',
      validation: 'User approves a requirement; approval status and approver name display in the UI.' },
    { reqId: 'REQ-DES-004', cat: 'Design Requirements', parent: 'REQ-DES-001',
      description: 'The frontend shall display design requirements in a tree table with expandable/collapsible hierarchy.',
      rationale: 'Tree view enables users to see requirement decomposition at a glance.',
      parameter: 'mat-table with flat data source built from hierarchical data. Rows indented by nesting level.',
      verification: 'Frontend tests verify tree building, expand/collapse, project filtering.',
      validation: 'User sees hierarchical requirement list, expands/collapses nodes, filters by project.' },
    { reqId: 'REQ-DES-005', cat: 'Design Requirements', parent: 'REQ-DES-001',
      description: 'The system shall provide separate create and edit pages for design requirements with form validation.',
      rationale: 'Dedicated pages allow focused requirement authoring.',
      parameter: 'Routes: /requirements/new (create), /requirements/:id/edit (edit with view-first pattern). Form fields: Project (required), Category (optional), Description (required), Rationale, Parameter, Parent Requirement, Verification, Validation.',
      verification: 'Frontend tests verify create vs edit mode, form validation, save/cancel/delete, approve/unapprove.',
      validation: 'User creates a new requirement with required fields, edits an existing one, approves it.' },
    { reqId: 'REQ-DES-006', cat: 'Design Requirements', parent: 'REQ-DES-001',
      description: 'Each design requirement must belong to a project (projectID FK → Projects).',
      rationale: 'Project association enables filtering and organization per ISO 13485:2016 §7.3.1.',
      parameter: 'projectID (INTEGER, NOT NULL, FK → Projects.id). GET endpoint supports ?projectID= filter.',
      verification: 'Backend tests: rejects missing projectID, filters by projectID, includes project association.',
      validation: 'User selects project when creating requirement; list view filters by project.' },
    { reqId: 'REQ-DES-007', cat: 'Design Requirements', parent: 'REQ-DES-001',
      description: 'The system shall support user-defined requirement categories via a RequirementCategories lookup table with CRUD.',
      rationale: 'Categories enable grouping requirements by type for organized review.',
      parameter: 'RequirementCategories table: id, name (STRING 100, UNIQUE), description, activeFlag.',
      verification: 'Backend tests: requirement-category.test.js (POST, duplicate, missing name, GET, PUT, DELETE, 401).',
      validation: 'User creates categories via manage dialog, assigns category to requirement.' },

    // Appendix A - Development
    { reqId: 'REQ-DEV-001', cat: 'Development', parent: 'REQ-SYS-001',
      description: 'The system shall use a client-server architecture with an Angular frontend and Node.js/Express backend communicating via REST API.',
      rationale: 'Separation of concerns enables independent frontend/backend development.',
      parameter: 'Frontend: Angular with standalone components and signals. Backend: Express.js with Sequelize ORM. Database: PostgreSQL.',
      verification: 'Backend API responds to HTTP requests. Frontend loads and renders in browser.',
      validation: 'Application functions end-to-end across network boundary.' },
    { reqId: 'REQ-DEV-002', cat: 'Development', parent: 'REQ-SYS-001',
      description: 'The system shall support environment-specific configuration for development and production deployments.',
      rationale: 'Different database hosts, OAuth callbacks, and API URLs per environment.',
      parameter: '.env.development for local dev, .env.production for production. NODE_ENV variable determines which file loads.',
      verification: 'Backend loads correct .env file based on NODE_ENV.',
      validation: 'Application connects to correct database and API endpoints in each environment.' },
    { reqId: 'REQ-DEV-003', cat: 'Development', parent: 'REQ-SYS-001',
      description: 'The system shall containerize the production deployment using Docker with automatic rebuilds.',
      rationale: 'Consistent deployment environment and developer experience.',
      parameter: 'docker-compose.prod.yml with backend Dockerfile. Image pushed to DockerHub.',
      verification: 'Docker build succeeds. Container starts and serves application.',
      validation: 'Production deployment accessible at configured URL.' },
    { reqId: 'REQ-DEV-004', cat: 'Development', parent: 'REQ-DEV-003',
      description: 'The system shall deploy via GitHub Actions on version tag push.',
      rationale: 'Automated CI/CD reduces manual deployment steps.',
      parameter: 'Trigger: v* tag push. Action: build Docker image, push to DockerHub with version and latest tags.',
      verification: 'GitHub Actions workflow runs on tag push. Image appears on DockerHub.',
      validation: 'New version deploys successfully via CI/CD pipeline.' },
    { reqId: 'REQ-DEV-005', cat: 'Development', parent: 'REQ-SYS-RD-003',
      description: 'The system shall provide automated PostgreSQL database backups with change detection and email notifications.',
      rationale: 'Data loss prevention requires regular, verified backups stored in multiple locations.',
      parameter: 'Daily pg_dump with change detection via pg_stat_user_tables hash. Email notifications via Gmail SMTP. Off-site pull via SCP.',
      verification: 'Backup script creates .dump file when data changes. Pull script downloads and removes remote files.',
      validation: 'Database can be restored from a backup file using pg_restore.' },
  ];

  // Create requirements in order, tracking IDs for parent references
  console.log(`\nCreating ${requirements.length} requirements...`);
  let created = 0;
  let failed = 0;

  for (const req of requirements) {
    const body = {
      description: `[${req.reqId}] ${req.description}`,
      rationale: req.rationale,
      parameter: req.parameter,
      verification: req.verification,
      validation: req.validation,
      projectID: projectID,
      categoryID: catMap[req.cat] || null,
      parentRequirementID: req.parent ? (reqIdMap[req.parent] || null) : null
    };

    const res = await fetch(`${BASE}/design/requirement`, {
      method: 'POST', headers,
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (data.id) {
      reqIdMap[req.reqId] = data.id;
      created++;
      if (created % 20 === 0) console.log(`  ...created ${created}/${requirements.length}`);
    } else {
      console.log(`  FAILED ${req.reqId}: ${JSON.stringify(data)}`);
      failed++;
    }
  }
  console.log(`Created: ${created}, Failed: ${failed}`);

  // 5. Approve a representative set of requirements to show both states
  const toApprove = [
    'REQ-SYS-001', 'REQ-SYS-004',
    'REQ-SYS-QMS-002', 'REQ-SYS-QMS-003', 'REQ-SYS-QMS-004',
    'REQ-SYS-DC-001', 'REQ-SYS-DC-002', 'REQ-SYS-DC-003', 'REQ-SYS-DC-004', 'REQ-SYS-DC-005',
    'REQ-SYS-IT-001', 'REQ-SYS-IT-002',
    'REQ-SYS-PP-001', 'REQ-SYS-PP-002',
    'REQ-SYS-LC-001',
    'REQ-SYS-RD-001', 'REQ-SYS-RD-002', 'REQ-SYS-RD-003',
    'REQ-AUTH-001', 'REQ-AUTH-002', 'REQ-AUTH-003', 'REQ-AUTH-004',
    'REQ-INV-001', 'REQ-INV-002', 'REQ-INV-005',
    'REQ-BAR-001', 'REQ-BAR-004',
    'REQ-PRT-001', 'REQ-PRT-002',
    'REQ-ORD-001',
    'REQ-HAR-001', 'REQ-HAR-013', 'REQ-HAR-014', 'REQ-HAR-015',
    'REQ-PLN-001', 'REQ-PLN-002', 'REQ-PLN-010',
    'REQ-FILE-001',
    'REQ-MOB-001',
    'REQ-NOTIF-001',
    'REQ-DES-001', 'REQ-DES-002', 'REQ-DES-003',
    'REQ-DEV-001',
  ];

  let approved = 0;
  for (const reqId of toApprove) {
    const id = reqIdMap[reqId];
    if (!id) continue;
    const res = await fetch(`${BASE}/design/requirement/${id}/approve`, {
      method: 'PUT', headers
    });
    if (res.ok) approved++;
  }
  console.log(`Approved: ${approved}/${toApprove.length}`);

  console.log('\nDone! Navigate to /requirements in the browser to see the seeded data.');
  console.log(`Total requirement IDs mapped: ${Object.keys(reqIdMap).length}`);
}

main().catch(console.error);
